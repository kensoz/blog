import{_ as e,o,c as p,a as s,d as t,b as n,e as c,r as i}from"./app.a5ec93c6.js";const l={},u=s("h1",{id:"\u4F7F\u7528vitest\u6D4B\u8BD5vue\u4E2D\u7684axios",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#\u4F7F\u7528vitest\u6D4B\u8BD5vue\u4E2D\u7684axios","aria-hidden":"true"},"#"),n(" \u4F7F\u7528Vitest\u6D4B\u8BD5Vue\u4E2D\u7684Axios")],-1),r=s("p",null,[s("img",{src:"https://img.shields.io/badge/-Vite-9ca3af.svg?logo=vite&style=popout-square",alt:""}),n(),s("img",{src:"https://img.shields.io/badge/-Vue.js-9ca3af.svg?logo=vue.js&style=popout-square",alt:""})],-1),d=n("\u{1F4E1} "),k={href:"https://segmentfault.com/a/1190000042295748",target:"_blank",rel:"noopener noreferrer"},v=n("\u601D\u5426"),m=n(" \xB7 "),h={href:"https://juejin.cn/post/7130069579182637087/",target:"_blank",rel:"noopener noreferrer"},_=n("\u6398\u91D1"),b=s("h2",{id:"_1-\u5B89\u88C5vitest",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#_1-\u5B89\u88C5vitest","aria-hidden":"true"},"#"),n(" 1.\u5B89\u88C5Vitest")],-1),g=n("\u53C2\u8003"),f={href:"https://vitest.dev/guide/#adding-vitest-to-your-project",target:"_blank",rel:"noopener noreferrer"},y=n("\u5B98\u7F51"),x=c(`<div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">yarn</span> <span class="token function">add</span> -D vitest
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u5982\u679C\u6CA1\u6709\u5B89\u88C5<code>vue-test-utils</code></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">yarn</span> <span class="token function">add</span> -D @vue/test-utils
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="_2-\u4F7F\u7528" tabindex="-1"><a class="header-anchor" href="#_2-\u4F7F\u7528" aria-hidden="true">#</a> 2.\u4F7F\u7528</h2><p>\u5728\u6D4B\u8BD5\u7528\u4F8B\u4E2D\uFF0C\u5047\u8BBE\u7EC4\u4EF6\u6302\u8D77\u5C31\u4F1A\u5411<code>/api/v1/test</code>\u53D1\u8D77<code>post</code>\u8BF7\u6C42</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> test<span class="token punctuation">,</span> expect<span class="token punctuation">,</span> vi <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vitest&#39;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> mount <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@vue/test-utils&#39;</span>
<span class="token keyword">import</span> Components <span class="token keyword">from</span> <span class="token string">&#39;@/components/Components.vue&#39;</span>

<span class="token comment">// \u6A21\u62DF\u8BF7\u6C42\u7684\u7ED3\u679C\uFF0C\u5047\u6570\u636E</span>
<span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token punctuation">{</span> message<span class="token operator">:</span> <span class="token string">&#39;data\u53D6\u5F97\u6210\u529F&#39;</span> <span class="token punctuation">}</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&#39;test&#39;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u8BBE\u7F6Eaxios\u76D1\u89C6\uFF0C\u5E76\u628A\u5047\u6570\u636E\u7ED1\u5B9A</span>
    <span class="token keyword">const</span> spyPost <span class="token operator">=</span> <span class="token keyword">await</span> vi<span class="token punctuation">.</span><span class="token function">spyOn</span><span class="token punctuation">(</span>axios<span class="token punctuation">,</span> <span class="token string">&#39;post&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mockResolvedValue</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
    <span class="token comment">// \u6302\u8F7D\u4F60\u7684vue\u7EC4\u4EF6</span>
    <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">mount</span><span class="token punctuation">(</span>Components\uFF09
    <span class="token comment">// \u6A21\u62DF\u8BF7\u6C42\u7684\u53C2\u6570                           </span>
    <span class="token keyword">const</span> params <span class="token operator">=</span> <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token string">&#39;1&#39;</span><span class="token punctuation">}</span>
    <span class="token comment">// \u6A21\u62DFpost\u8BF7\u6C42\u5E76\u9A8C\u8BC1</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>axios<span class="token punctuation">.</span>post<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledWith</span><span class="token punctuation">(</span><span class="token string">&#39;/api/v1/test&#39;</span><span class="token punctuation">,</span> params<span class="token punctuation">)</span>
    <span class="token comment">// \u6A21\u62DF\u8BF7\u6C42\u5E76\u9A8C\u8BC1\u7ED3\u679C</span>
    <span class="token function">expect</span><span class="token punctuation">(</span><span class="token keyword">await</span> axios<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>res <span class="token operator">=&gt;</span> res<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
    <span class="token comment">// \u6E05\u9664axios\u76D1\u89C6</span>
    spyPost<span class="token punctuation">.</span><span class="token function">mockRestore</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,6);function w(V,j){const a=i("ExternalLinkIcon");return o(),p("div",null,[u,r,s("p",null,[d,s("a",k,[v,t(a)]),m,s("a",h,[_,t(a)])]),b,s("p",null,[g,s("a",f,[y,t(a)])]),x])}var C=e(l,[["render",w],["__file","vitest.html.vue"]]);export{C as default};
